package app.graphic.path ;

import java.util.Random;

import app.fxml.controleurs.MainController;
import app.graphicplace.GraphicPlace;
import app.model.map.Path;
import app.model.map.Place;
import javafx.fxml.FXML;
import javafx.scene.control.Label;
import javafx.scene.layout.Pane;
import javafx.scene.paint.Color;
import javafx.scene.shape.Line;

public class GraphicPath extends Line {

    private final Path path;
    @FXML
	private Pane zoneGraphique;
    @FXML
    private Line line;
    private final Place startPlace;
    private final Place endPlace;
    private final Label distanceLabel;
    private GraphicPathState state;
    public MainController app;

    public GraphicPath(Path path, Place start, Place end){
        this.path = path;
        this.startPlace = start;
        this.endPlace = end;
		// pour que case DEFAULT soit le mode dÃ©faut 
        this.state = GraphicPathState.DEFAULT;

        /*startXProperty().bind( start.layoutXProperty().add(start.getBoundsInParent().getWidth() / 2));
        startYProperty().bind( start.layoutYProperty().add(start.getBoundsInParent().getHeight() / 2));
        endXProperty().bind( end.layoutXProperty().add(end.getBoundsInParent().getWidth() / 2));
        endYProperty().bind( end.layoutYProperty().add(end.getBoundsInParent().getHeight() / 2));*/

        // Label
        distanceLabel = new Label( String.valueOf( path.getLength() ) );
        updateLabelPosition();

        // Le Node.toBack
        this.toBack();
    }

    public void setState(GraphicPathState newState){
        this.state = newState;

        switch (newState){
            case DEFAULT:
                setStroke( Color.BLACK );
                break;

            case HAS_FOCUS:
                setStroke( Color.BLUE );
                break;

            case HAS_FOCUS_MODIFIED:
                setStroke( Color.ORANGE );
                break;
        }
    }

    public GraphicPathState getState() {
        return state;
    }

    public Label getLabel() {
        return distanceLabel;
    }

	public Path getPath() {
        return path;
    }

    public void updateLabelPosition(){
        double midX = ( getStartX() + getEndX() )/ 2;
        double midY = ( getStartY() + getEndY() )/ 2;
        distanceLabel.setLayoutX( midX );
        distanceLabel.setLayoutY( midY );
    }
    
    
    public void setApp(MainController app) {
    	this.app=app;
    	this.app = app;
		zoneGraphique.widthProperty().addListener((obs, oldVal, newVal) -> {
			if (newVal.doubleValue() > 0 && zoneGraphique.getHeight() > 0) {
				ajouterTousPath();
			}
		});

		zoneGraphique.heightProperty().addListener((obs, oldVal, newVal) -> {
			if (newVal.doubleValue() > 0) {
				ajouterTousPath();
			}
		});
    }
    public void ajouterTousPath() {
    	zoneGraphique.getChildren().clear();
		for (Path path : app.world.getPaths()) {
			ajouterPath(path, path.getFirstPlace(),path.getSecondPlace() );
		}
    }
    
	public void ajouterPath(Path path, Place place1, Place place2) {
		//System.out.println(Place.getName());
		Random rand = new Random();
		double radius = 15;
		double width = zoneGraphique.getWidth();
		double height = zoneGraphique.getHeight();
		double x = rand.nextDouble() * (width - 2 * radius);
		double y = rand.nextDouble() * (height - 2 * radius);

		
		GraphicPath line = new GraphicPath(path ,place1, place2);
		
		
		//cercle.setStrokeWidth(10.0);
		line.setStroke(Color.BLACK);
		//cercle.setFill(changeColor(Place));
		
		
		Label Idnom = new Label(String.valueOf(1));
		Idnom.setStyle("-fx-font-weight: bold; -fx-text-fill: black;");
		Idnom.layoutXProperty().bind(line.endYProperty().subtract(Idnom.widthProperty().divide(2)));
		Idnom.layoutYProperty().bind(line.endYProperty().subtract(Idnom.heightProperty().divide(2)));
		Idnom.setMouseTransparent(true);
		zoneGraphique.getChildren().addAll(line, Idnom);
   

		}
	}
